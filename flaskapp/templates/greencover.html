<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f4f4f4;
    }

    h2,
    h3 {
      color: #333;
      padding: 20px;
    }

    h3 {
      display: flex;
      align-items: center;
    }

    input[type="file"] {
      display: block;
      margin: 20px;
    }

    .image-container {
      display: flex;
      justify-content: space-around;
    }

    .image-container img {
      max-width: calc(50% - 40px);
    }

    #green-cover-percentage {
      font-size: 24px;
    }

    #idle-land-percentage {
      font-size: 24px;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

  <center>
    <h2>Estimate the Percentage of Green Cover</h2>

    <label for="formFile" class="form-label">Upload an image to estimate the percentaege of green cover in it</label>
    <div class="mb-3" style="width: 20%;">
      <input class="form-control" type="file" id="image-file" accept="image/*">
    </div>

    <div id="loader" style="display: none; justify-content: center;">
      <div class="spinner-border text-success" role="status" style="width: 25px; height: 25px;">
        <span class="sr-only"></span>
      </div>
      <p style="color: green; margin-left: 10px;">Please wait while make the estimation</p>
    </div>
    <button onclick="initiateProcess()" class="btn btn-success" id="processImage">Process Image</button>
  </center>



  <div id="container" style="display: none;">
    <h3 style="display: flex; justify-content: center; margin-bottom: 0px;" id="green-cover-percentage"></h3>
    <h3 style="display: flex; justify-content: center; margin-top: 0px;" id="idle-land-percentage"></h3>

    <h3>Processed Image:</h3>
    <div class="image-container" style="margin-bottom: 80px;">
      <img id="uploaded-image" src="" alt="Uploaded Image">
      <img id="processed-image" src="" alt="Processed Image">
    </div>


  </div>


 
  <input type="hidden" id="green">
  <input type="hidden" id="idle">

  <script>
    const container = document.getElementById('container');
    const processImageBtn = document.getElementById('processImage');
    const loader = document.getElementById('loader');

    function initiateProcess() {
      processImageBtn.style.display = 'none';
      loader.style.display = 'flex';


      setTimeout(() => {
        processImage();
      }, 3000);


    }


    function processImage() {
      const fileInput = document.getElementById('image-file');
      const file = fileInput.files[0];
      const reader = new FileReader();

      reader.onloadend = () => {
        const uploadedImage = document.getElementById('uploaded-image');
        const processedImage = document.getElementById('processed-image');
        const greenCoverPercentage = document.getElementById('green-cover-percentage');
        const idleLandPercentage = document.getElementById('idle-land-percentage');

        const img = new Image();
        img.onload = () => {
          let blackPixelCount = 0;
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');
  
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

          // Calculate the mean green value
          let totalGreen = 0;
          for (let i = 1; i < imageData.data.length; i += 4) {
            totalGreen += imageData.data[i];
          }
          const meanGreen = totalGreen / (imageData.data.length / 4);

          for (let i = 0; i < imageData.data.length; i += 4) {
            let gray = (imageData.data[i + 1]) * 0.587; // Keep only green channel

            if (gray < meanGreen / 1.5) {
              gray = 0;
              blackPixelCount++;
            } else {
              gray = 255;
            }

            imageData.data[i] = gray;   // Red channel
            imageData.data[i + 1] = gray; // Green channel
            imageData.data[i + 2] = gray; // Blue channel
            imageData.data[i + 3] = 255;  // Alpha channel

          }

          ctx.putImageData(imageData, 0, 0);

          // Display the processed image and green cover percentage
          processedImage.src = canvas.toDataURL();
          greenCoverPercentage.innerHTML = 'Green Cover Percentage: ' + ((blackPixelCount / (canvas.width * canvas.height)) * 100).toFixed(2) + '%';
          idleLandPercentage.innerHTML = 'Idle Land Percentage: ' + (100 - ((blackPixelCount / (canvas.width * canvas.height)) * 100)).toFixed(2) + '%';


        };
        img.src = reader.result;
        uploadedImage.src = reader.result;
        container.style.display = 'block';
        processImageBtn.style.display = 'block';
        loader.style.display = 'none';
      };
      reader.readAsDataURL(file);
    }
  </script>
</body>
</html>