<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Find Optimal Path from A to B</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <form action="/optimalpath" method="post" enctype="multipart/form-data" style="margin: 50px;">
        <h3 style="display: flex; justify-content: center;">This feature helps to find the optimal path from point A to
            B on an image that passes throgh the least number of trees</h2>
            <br>
            <div style="display: flex;">
                <label for="image" style="margin-top: 5px;">Select an image:</label> &nbsp;&nbsp;
                <div class="mb-3" style="width: 20%;" id="image">
                    <input class="form-control" type="file" name="image" accept="image/*" required id="imageInput">
                </div>
            </div>
            <label for="choiceElement" style="margin-top: 5px;">Select starting or ending point:</label>
            <select id="choiceElement">
                <option value="choice" disabled selected>Select</option>
                <option value="Starting">Starting Point</option>
                <option value="Ending">Ending Point</option>
            </select>
            <br><br>
            <b id="startingCoordinates"></b><br>
            <b id="endingCoordinates"></b><br>
            <b><small id="dimensions" style="margin-top: 0px;"></small></b>
            <img id="displayedImage" style="display: none; max-width: 100%; height: auto;">

            <input type="hidden" id="X1" name="X1">
            <input type="hidden" id="Y1" name="Y1">
            <input type="hidden" id="X2" name="X2">
            <input type="hidden" id="Y2" name="Y2">
            <div id="loader" style="display: none; margin-top: 20px; margin-bottom: 30px;">
                <div class="spinner-border text-success" role="status" style="width: 25px; height: 25px;">
                    <span class="sr-only"></span>
                </div>
                <p style="color: green; margin-left: 10px;">Please wait...This may take a few minutes</p>
            </div>
            <br><br>
            <button type="submit" class="btn btn-success" id="submit">Submit</button>
    </form>


    <script>
        const choiceElement = document.getElementById('choiceElement');
        const X1 = document.getElementById('X1');
        const Y1 = document.getElementById('Y1');
        const X2 = document.getElementById('X2');
        const Y2 = document.getElementById('Y2');
        const startingCoordinates = document.getElementById('startingCoordinates');
        const endingCoordinates = document.getElementById('endingCoordinates');

        document.getElementById('imageInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const img = document.getElementById('displayedImage');
                img.src = URL.createObjectURL(file);
                img.style.display = 'block';

                img.onload = function () {
                    // Image loaded, you can perform additional actions if needed
                };

                img.onerror = function () {
                    console.error('Invalid image file.');
                };
            } else {
                const img = document.getElementById('displayedImage');
                img.src = '';
                img.style.display = 'none';
            }
        });

        document.getElementById('displayedImage').addEventListener('click', function (event) {
            this.style.cursor = 'pointer';
            const x = event.offsetX;
            const y = event.offsetY;
            if (choiceElement.value === "Starting")
            {
                X1.value = x;
                Y1.value = y;
                startingCoordinates.textContent = `Starting Point: (${x}, ${y})`
            }
            else if (choiceElement.value === "Ending")
            {
                X2.value = x;
                Y2.value = y;
                endingCoordinates.textContent = `Ending Point: (${x}, ${y})`
            }
        });

    </script>

    <script>
        var width = 0;
        var height = 0;
        document.getElementById('imageInput').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const img = new Image();
                img.onload = function () {
                    width = img.naturalWidth;
                    height = img.naturalHeight;
                    document.getElementById('dimensions').textContent = `Width: ${width}px, Height: ${height}px`;
                };
                img.onerror = function () {
                    document.getElementById('dimensions').textContent = 'Invalid image file.';
                };
                img.src = URL.createObjectURL(file);
            } else {
                document.getElementById('dimensions').textContent = '';
            }
        });



        submit.addEventListener('click', function () {
            loader.style.display = 'flex';
            submit.style.display = 'none';
        })


    </script>
</body>

</html>